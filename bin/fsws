#!/usr/bin/env ruby

require 'fsws'
require 'thin'

port = (ARGV[0] || 8000).to_i
interface = '0.0.0.0'

Thin::Logging.silent = true
server = Thin::Server.new(interface, port, Fsws::server, signals: false)

if Signal.list.key? 'QUIT'
  Signal.trap('QUIT') do
    puts 'Stopping...'
    server.stop
  end
end

if Signal.list.key? 'INT'
  Signal.trap('INT') do
    puts 'Stopping...'
    server.stop!
  end
end

def normalize(path)
  path.gsub(File::SEPARATOR, File::ALT_SEPARATOR || File::SEPARATOR)
end

puts ">> Serving #{normalize(Dir.pwd)}"
puts ">> Listening on #{interface}:#{port}"
puts ">> Ctrl+C to stop"
server.start
